# Пропозиції щодо розвитку вкладки налаштувань

## Поточний стан (вже реалізовано)

1. ✅ **Профіль користувача**
   - Редагування імені
   - Перегляд email, ролі, компанії, дати реєстрації

2. ✅ **Зміна пароля**
   - Поточний пароль
   - Новий пароль з підтвердженням
   - Валідація (мін. 6 символів)

3. ✅ **Налаштування компанії**
   - Перегляд інформації про компанію
   - Назва, ЄДРПОУ, статус, дата реєстрації

4. ✅ **Токен митниці**
   - Оновлення токену
   - Інструкція з отримання токену
   - Індикатор наявності токену

5. ✅ **Налаштування експорту**
   - Вибір колонок для експорту в Excel
   - Збереження улюблених колонок
   - "Вибрати всі" / "Скинути всі"

---

## Пропозиції для додавання

### 1. Налаштування синхронізації (Високий пріоритет)

#### 1.1 Автоматична синхронізація
- [x] Включити/вимкнути автоматичну синхронізацію (виконується при вході)
- [ ] Період автоматичної синхронізації:
  - Щодня
  - Тиждень
  - Місяць
  - Вимкнено (за замовчуванням)
- [ ] Час автоматичної синхронізації (вибір часу дня)
- [ ] Дні тижня для синхронізації (якщо вибрано "тиждень")

#### 1.2 Налаштування продуктивності
- [x] Затримка між запитами (секунди)
  - Поточна: 2 секунди між chunks 60.1
  - Можливість налаштування від 1 до 10 секунд
- [x] Розмір chunk для синхронізації
  - Поточна: 7 днів
  - Можливість вибору: 3, 7, 14, 30 днів
- [ ] Максимальна кількість одночасних запитів

#### 1.3 Сповіщення про синхронізацію
- [x] Email-сповіщення про завершення синхронізації (налаштування присутні)
- [x] Email-сповіщення про помилки синхронізації (налаштування присутні)
- [x] Email-сповіщення про критичні помилки (3+ помилок)
- [x] Браузерні сповіщення (перемикач присутній)

---

### 2. Налаштування інтерфейсу (Середній пріоритет)

#### 2.1 Архів
- [x] Кількість елементів на сторінці за замовчуванням
  - Опції: 20, 50, 100, 200
  - Поточна: 20 (зберігається в localStorage)
- [x] Режим відображення за замовчуванням
  - Таблиця / Картки / Компактний
  - Збереження в localStorage
- [x] Активна вкладка за замовчуванням при відкритті
  - Список 60.1 / Деталі 61.1

#### 2.2 Дашборд
- [x] Які статистики відображати на дашборді (реалізовано через модальне вікно налаштувань)
  - Кількість декларацій
  - Митна вартість
  - Фактурна вартість
  - Топ контрагенти
  - Топ коди УКТЗЕД
  - і т.д.

#### 2.3 Тема оформлення
- [x] Світла тема (поточна)
- [x] Темна тема (реалізовано підтримку класів dark)
- [x] Автоматична тема (за системними налаштуваннями)

---

### 3. Безпека та конфіденційність (Високий пріоритет)

#### 3.1 Аутентифікація
- [ ] Зміна email
  - Підтвердження поточного email
  - Введення нового email
  - Підтвердження через email
- [ ] Двокрокова аутентифікація (2FA)
  - Включити/вимкнути
  - Генерація QR-коду для аутентифікатора
  - Резервні коди для відновлення
- [ ] Активні сесії
  - Список активних сесій (пристрій, IP, остання активність)
  - Можливість завершити конкретну сесію
  - Завершити всі сесії крім поточної

#### 3.2 Історія безпеки
- [ ] Історія входів
  - Дата/час, IP-адреса, пристрій, статус (успішний/неуспішний)
  - Експорт історії
- [ ] Історія змін паролю
- [ ] Історія оновлення токену митниці

---

### 4. Сповіщення (Середній пріоритет)

#### 4.1 Email-сповіщення
- [ ] Загальні налаштування
  - Включити/вимкнути всі email-сповіщення
  - Email для сповіщень (може відрізнятися від основного)
- [ ] Типи подій для сповіщень:
  - [ ] Завершення синхронізації
  - [ ] Помилки під час синхронізації
  - [ ] Критичні помилки (3+ помилок в chunk)
  - [ ] Нові декларації (якщо планується моніторинг)
  - [ ] Зміни статусу декларацій (якщо планується моніторинг)

#### 4.2 Браузерні сповіщення
- [ ] Включити/вимкнути браузерні сповіщення
- [ ] Дозвіл на сповіщення в браузері
- [ ] Налаштування типів подій для сповіщень
  - Те ж саме, що й для email

---

### 5. Керування даними (Середній пріоритет)

#### 5.1 Експорт даних
- [x] Експорт декларацій в Excel (з вибором колонок)
- [ ] Експорт всіх даних користувача (GDPR compliance)

#### 5.2 Видалення даних
- [ ] Видалення облікового запису
  - Попередження про остаточне видалення
  - Підтвердження паролем
  - Варіанти:
    - Видалити тільки обліковий запис (залишити декларації компанії)
    - Видалити обліковий запис та всі декларації
- [ ] Очищення кешу статистики
- [x] Очищення старих даних (реалізовано видалення за період в архіві)
  - Видалити декларації старше X місяців

---

### 6. Інтеграції (Низький пріоритет)

#### 6.1 API доступ
- [ ] Генерація API ключів
- [ ] Список активних API ключів
- [ ] Відкликання API ключів
- [ ] Ліміти API (rate limiting)
- [ ] Документація API

#### 6.2 Webhooks
- [ ] Налаштування webhook URL
- [ ] Вибір подій для webhook
  - Завершення синхронізації
  - Нові декларації
  - Помилки синхронізації
- [ ] Тестування webhook
- [ ] Історія webhook викликів

---

### 7. Мова та локалізація (Низький пріоритет)

- [ ] Вибір мови інтерфейсу
  - Українська (поточна)
  - Англійська (майбутнє)
- [ ] Формат дати
  - DD.MM.YYYY
  - MM/DD/YYYY
  - YYYY-MM-DD
- [ ] Формат часу
  - 24-годинний
  - 12-годинний
- [ ] Часовий пояс

---

### 8. Розширені налаштування (Низький пріоритет)

#### 8.1 Налаштування статистики
- [ ] Період для статистики за замовчуванням
  - Останній місяць
  - Останні 3 місяці
  - Останній рік
  - Весь період
- [x] Включені статистики на архіві (вибір через модальне вікно)
  - Список з DEFAULT_STATS_SETTINGS
  - Включити/вимкнути кожну статистику

#### 8.2 Налаштування фільтрів
- [ ] Збережені фільтри
  - Зберегти поточні фільтри як пресет
  - Завантажити збережений пресет
  - Видалити пресет

---

## Пріоритети реалізації

### Фаза 1 (Критично важливо)
1. **Налаштування інтерфейсу** (швидко, корисно)
   - Кількість елементів на сторінці
   - Режим відображення за замовчуванням

2. **Безпека - Активні сесії**
   - Перегляд активних сесій
   - Завершення сесій

### Фаза 2 (Важливо)
3. **Налаштування синхронізації**
   - Автоматична синхронізація
   - Налаштування періоду та часу

4. **Безпека - Історія входів**
   - Перегляд історії входів
   - Експорт історії

### Фаза 3 (Бажано)
5. **Сповіщення**
   - Email-сповіщення
   - Браузерні сповіщення

6. **Керування даними**
   - Експорт даних (GDPR)
   - Видалення облікового запису

### Фаза 4 (Майбутнє)
7. **Інтеграції**
   - API ключі
   - Webhooks

8. **Розширені налаштування**
   - Збережені фільтри
   - Налаштування статистики

---

## Технічні деталі для реалізації

### Збереження налаштувань

#### Варіант 1: localStorage (прості налаштування)
- Кількість елементів на сторінці
- Режим відображення
- Налаштування експорту (вже реалізовано)

#### Варіант 2: База даних (складні налаштування)
- Налаштування синхронізації
- Налаштування сповіщень
- Активні сесії
- Історія входів

#### Потрібні зміни в schema.prisma:

```prisma
model User {
  // ... існуючі поля
  
  // Налаштування
  settings Json? // JSON з налаштуваннями
  
  // Сесії
  sessions UserSession[]
  
  // Історія входів
  loginHistory LoginHistory[]
}

model UserSession {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  sessionId String   @unique // NextAuth session ID
  ipAddress String?
  userAgent String?
  device    String?
  lastActive DateTime @default(now())
  createdAt DateTime @default(now())
  
  @@index([userId])
}

model LoginHistory {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  ipAddress String?
  userAgent String?
  device    String?
  success   Boolean  @default(true)
  reason    String? // Причина неуспішного входу
  createdAt DateTime @default(now())
  
  @@index([userId])
  @@index([createdAt])
}

model Company {
  // ... існуючі поля
  
  // Налаштування синхронізації
  syncSettings Json? // JSON з налаштуваннями синхронізації
}
```

---

## Нотатки

- Усі налаштування повинні мати значення за замовчуванням
- При видаленні облікового запису використовувати каскадне видалення для пов'язаних даних
- Для безпеки: логування всіх змін критичних налаштувань (пароль, email, токен)
- GDPR compliance: можливість експорту та видалення всіх даних користувача
