# План розробки розширеного дашборду

## 📊 Доступні дані з декларацій

### База даних (Declaration + DeclarationSummary):
- **Статуси**: CLEARED, PROCESSING, REJECTED, DRAFT
- **Дата**: `date` (дата створення), `registeredDate` (дата реєстрації в митниці)
- **Фінансові дані**:
  - `customsValue` - митна вартість
  - `invoiceValue` - фактурна вартість (валюта)
  - `invoiceValueUah` - фактурна вартість в UAH
  - `exchangeRate` - курс валют
  - `currency`, `invoiceCurrency` - валюти
- **Географічні дані**:
  - `customsOffice` - митниця
  - `senderName` - відправник
  - `recipientName` - отримувач
- **Товари**:
  - `totalItems` - загальна кількість товарів
- **Типи**:
  - `declarationType` - тип декларації
  - `transportDetails` - транспорт

### Додаткові дані з XML (якщо потрібно парсити):
- Контрагенти (consignor, consignee, contract holder)
- Коди УКТЗЕД
- Платежі та податки
- Протоколи та документи

---

## 🎯 Рекомендована логіка дашборду

### 1. **Основні метрики (KPI Cards)**
- ✅ Всього декларацій (вже є)
- ✅ Успішно оформлено (вже є)
- ✅ В обробці (вже є)
- ✅ Відхилено (вже є)
- ➕ **Нові метрики**:
  - Загальна митна вартість (сума)
  - Загальна фактурна вартість в UAH
  - Середня митна вартість на декларацію
  - Загальна кількість товарів

### 2. **Графіки трендів (Charts)**
- 📈 **Динаміка декларацій за періодом** (діаграма лінійна)
  - За останні 30/90/365 днів
  - Групування по днях/тижнях/місяцях
  - Розбивка по статусах
- 📊 **Розподіл по місяцях** (bar chart)
  - Кількість декларацій
  - Загальна вартість
- 💰 **Фінансова динаміка** (лінійний графік)
  - Митна вартість по часу
  - Фактурна вартість по часу
  - Порівняння з попереднім періодом

### 3. **Топ-10 списки**
- 🏢 Топ-10 відправників (за кількістю та сумою)
- 📦 Топ-10 отримувачів (за кількістю та сумою)
- 🏛️ Топ-10 митниць (за кількістю та сумою)
- 📋 Топ-10 типів декларацій
- 🌍 Топ-10 країн (якщо є дані)

### 4. **Порівняльна аналітика**
- 📅 Порівняння з попереднім періодом:
  - Зміна кількості декларацій (%)
  - Зміна загальної вартості (%)
  - Зміна середньої вартості (%)
- 📊 Статистика за періоди:
  - Сьогодні vs вчора
  - Цей тиждень vs минулий тиждень
  - Цей місяць vs минулий місяць
  - Цей рік vs минулий рік

### 5. **Фінансова аналітика**
- 💵 Загальна митна вартість (в UAH)
- 💵 Загальна фактурна вартість (в UAH)
- 📈 Середня митна вартість на декларацію
- 📊 Розподіл по валютах (pie chart)
- 💰 Топ-10 найбільших декларацій за вартістю

### 6. **Ефективність та прогнози**
- ⚡ Середній час обробки (від реєстрації до оформлення)
- 📉 Успішність оформлення (clearance rate)
- 📊 Прогноз на наступний місяць (на основі тренду)

---

## 📐 Структура компонентів

### 1. Розширений `getDashboardAnalytics` (server action)
```typescript
// Повертає:
{
  // Базові метрики
  total, cleared, processing, rejected,
  
  // Фінансові метрики
  totalCustomsValue, totalInvoiceValueUah, avgCustomsValue,
  totalItems,
  
  // Тренди (по днях за останні 30 днів)
  trends: {
    date: string,
    count: number,
    customsValue: number,
    cleared: number,
    processing: number,
  }[],
  
  // Топ-10 списки
  topConsignors: [...],
  topConsignees: [...],
  topCustomsOffices: [...],
  topDeclarationTypes: [...],
  
  // Порівняння
  comparison: {
    period: 'week' | 'month',
    countChange: number, // %
    valueChange: number, // %
  },
  
  // Статистика по валютах
  byCurrency: { currency: string, count: number, totalValue: number }[],
}
```

### 2. Компоненти дашборду:
- `DashboardKPICards` - картки з основними метриками
- `DashboardTrendsChart` - графік трендів (використовувати recharts)
- `DashboardTopLists` - топ-10 списки
- `DashboardComparison` - порівняння періодів
- `DashboardFinancialChart` - фінансові графіки
- `DashboardCurrencyDistribution` - розподіл по валютах

---

## 🎨 Візуальна структура

```
┌─────────────────────────────────────────────────────────┐
│  Заголовок: Огляд митної активності                     │
├─────────────────────────────────────────────────────────┤
│  KPI Cards (4-6 карток):                                │
│  [Всього] [Оформлено] [В обробці] [Відхилено]          │
│  [Митна вартість] [Фактурна вартість]                   │
├─────────────────────────────────────────────────────────┤
│  Графік трендів (30/90/365 днів):                       │
│  ┌─────────────────────────────────────────────────┐    │
│  │         📈 Лінійний графік                      │    │
│  │         Динаміка декларацій                     │    │
│  │         + Розбивка по статусах                  │    │
│  └─────────────────────────────────────────────────┘    │
├─────────────────────────────────────────────────────────┤
│  Фінансова аналітика:                                   │
│  ┌─────────────────────┬───────────────────────────┐    │
│  │ 💰 Митна вартість   │ 💵 Фактурна вартість      │    │
│  │ 📊 Розподіл валют   │ 📈 Прогноз                │    │
│  └─────────────────────┴───────────────────────────┘    │
├─────────────────────────────────────────────────────────┤
│  Топ-10 списки (таби або аккордеон):                    │
│  ┌─────────────────────────────────────────────────┐    │
│  │ [Відправники] [Отримувачі] [Митниці] [Типи]    │    │
│  │                                                 │    │
│  │ 1. Назва | Кількість | Сума                    │    │
│  │ 2. Назва | Кількість | Сума                    │    │
│  │ ...                                             │    │
│  └─────────────────────────────────────────────────┘    │
├─────────────────────────────────────────────────────────┤
│  Порівняння періодів:                                   │
│  ┌─────────────────────────────────────────────────┐    │
│  │ Цей тиждень vs Минулий тиждень                  │    │
│  │ 📈 +15% декларацій  📊 +12% вартість            │    │
│  └─────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────┘
```

---

## 🔧 Технічні деталі

### Візуалізація:
- Використати `recharts` (вже встановлено)
- Responsive дизайн для мобільних пристроїв
- Темна/світла тема (якщо підтримується)

### Оптимізація:
- Кешування аналітики в `statistics-cache.ts` (аналогічно до архіву)
- Запити до БД через Prisma з агрегаціями
- Використання `summary` таблиці для швидкої аналітики

### Періоди для фільтрів:
- Останні 7 днів
- Останні 30 днів
- Останні 90 днів
- Останні 365 днів
- Цей місяць
- Цей рік
- Власний період (date picker)

---

## ✅ План реалізації

### Етап 1: Розширення `getDashboardAnalytics`
- [ ] Додати фінансові метрики
- [ ] Додати розрахунок трендів
- [ ] Додати топ-10 списки
- [ ] Додати порівняння періодів

### Етап 2: Компоненти UI
- [ ] Розширити KPI картки
- [ ] Додати графік трендів
- [ ] Додати топ-10 списки
- [ ] Додати порівняння періодів

### Етап 3: Оптимізація
- [ ] Додати кешування аналітики
- [ ] Оптимізувати запити до БД
- [ ] Додати фільтри періодів

---

**Пріоритет**: Високий  
**Складність**: Середня  
**Час розробки**: 4-6 годин
